<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫£i Video TikTok Kh√¥ng Watermark - 100% Web Tƒ©nh</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(to right, #fe2c55, #25d3ea);
            color: white;
            padding: 30px;
            text-align: center;
        }
        h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .subtitle { font-size: 1.1rem; opacity: 0.9; }
        main { padding: 30px; }
        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        h2 { color: #fe2c55; margin-bottom: 20px; font-size: 1.5rem; }
        .input-group { margin-bottom: 20px; }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        input[type="text"]:focus, textarea:focus {
            border-color: #fe2c55;
            outline: none;
            box-shadow: 0 0 0 3px rgba(254, 44, 85, 0.1);
        }
        textarea {
            height: 150px;
            font-family: monospace;
            resize: vertical;
        }
        .hint {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
        .btn {
            background: linear-gradient(to right, #fe2c55, #25d3ea);
            color: white;
            border: none;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(254, 44, 85, 0.3);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: #6c757d;
            padding: 12px 24px;
            font-size: 16px;
        }
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        #results {
            margin-top: 40px;
            display: none;
        }
        .video-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .video-card:hover {
            border-color: #fe2c55;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        .video-info { flex: 1; }
        .video-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #212529;
        }
        .video-url {
            font-size: 0.9rem;
            color: #6c757d;
            word-break: break-all;
        }
        .video-meta {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #495057;
        }
        .video-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-processing { background: #cce5ff; color: #004085; }
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #fe2c55;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .api-selector {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .api-option {
            flex: 1;
            min-width: 200px;
        }
        .api-option select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
        }
        footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
            border-top: 1px solid #e9ecef;
            margin-top: 30px;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        @media (max-width: 768px) {
            .container { border-radius: 0; }
            header { padding: 20px; }
            h1 { font-size: 2rem; }
            main { padding: 20px; }
            .video-card { flex-direction: column; align-items: flex-start; }
            .video-actions { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚¨áÔ∏è T·∫£i Video TikTok</h1>
            <p class="subtitle">C√¥ng c·ª• web tƒ©nh 100% - Kh√¥ng backend - Kh√¥ng watermark - ƒêa lu·ªìng</p>
        </header>
        
        <main>
            <div class="warning">
                <strong>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</strong> C√¥ng c·ª• n√†y s·ª≠ d·ª•ng API c√¥ng khai mi·ªÖn ph√≠ v√† c√≥ th·ªÉ ng·ª´ng ho·∫°t ƒë·ªông n·∫øu c√°c d·ªãch v·ª• ƒë√≥ thay ƒë·ªïi. H√£y t√¥n tr·ªçng b·∫£n quy·ªÅn v√† ch·ªâ t·∫£i video cho m·ª•c ƒë√≠ch c√° nh√¢n.
            </div>
            
            <div class="card">
                <h2>üì• Nh·∫≠p Li√™n K·∫øt TikTok</h2>
                
                <div class="input-group">
                    <label for="singleUrl">T·∫£i m·ªôt video:</label>
                    <input type="text" id="singleUrl" placeholder="https://www.tiktok.com/@username/video/1234567890" />
                </div>
                
                <div class="input-group">
                    <label for="batchUrls">T·∫£i nhi·ªÅu video c√πng l√∫c (m·ªói d√≤ng m·ªôt li√™n k·∫øt):</label>
                    <textarea id="batchUrls" placeholder="https://www.tiktok.com/@user1/video/1111111
https://www.tiktok.com/@user2/video/2222222
https://vt.tiktok.com/ABC123/"></textarea>
                    <div class="hint">T·ªëi ƒëa 10 video m·ªói l·∫ßn ƒë·ªÉ tr√°nh b·ªã ch·∫∑n.</div>
                </div>
                
                <div class="api-selector">
                    <div class="api-option">
                        <label for="apiProvider">Ch·ªçn d·ªãch v·ª• API:</label>
                        <select id="apiProvider">
                            <option value="tikwm">TikWM (nhanh, ·ªïn ƒë·ªãnh)</option>
                            <option value="tikmate">TikMate (d·ª± ph√≤ng)</option>
                            <option value="snaptik">SnapTik (ch·∫•t l∆∞·ª£ng cao)</option>
                        </select>
                    </div>
                    <div class="api-option">
                        <label for="proxyProvider">Ch·ªçn Proxy CORS:</label>
                        <select id="proxyProvider">
                            <option value="allorigins">AllOrigins (m·∫∑c ƒë·ªãnh)</option>
                            <option value="corsproxy">CORS-Proxy (d·ª± ph√≤ng)</option>
                            <option value="thingproxy">ThingProxy (d·ª± ph√≤ng 2)</option>
                        </select>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn" onclick="downloadSingle()" id="singleBtn">
                        <span>‚¨áÔ∏è T·∫£i Video N√†y</span>
                    </button>
                    <button class="btn" onclick="downloadBatch()" id="batchBtn">
                        <span>üöÄ T·∫£i T·∫•t C·∫£ Video</span>
                    </button>
                    <button class="btn btn-secondary" onclick="clearAll()">
                        <span>üóëÔ∏è X√≥a T·∫•t C·∫£</span>
                    </button>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ƒêang x·ª≠ l√Ω video... Vui l√≤ng ch·ªù</p>
                <div id="progress" style="margin-top: 10px;"></div>
            </div>
            
            <div id="results">
                <h2>üìã K·∫øt Qu·∫£ T·∫£i Xu·ªëng</h2>
                <div id="resultContainer"></div>
            </div>
        </main>
        
        <footer>
            <p>C√¥ng c·ª• web tƒ©nh 100% | S·ª≠ d·ª•ng API c√¥ng khai mi·ªÖn ph√≠ | Kh√¥ng l∆∞u tr·ªØ d·ªØ li·ªáu</p>
            <p>Video ƒë∆∞·ª£c t·∫£i v·ªÅ kh√¥ng ch·ª©a watermark TikTok | T·ªïng s·ªë video ƒë√£ x·ª≠ l√Ω: <span id="totalCount">0</span></p>
        </footer>
    </div>

    <script>
        // C·∫•u h√¨nh API v√† Proxy
        const API_CONFIG = {
            tikwm: {
                name: "TikWM",
                url: "https://www.tikwm.com/api/",
                method: "POST",
                getVideoUrl: (data) => data.data.play || data.data.wmplay
            },
            tikmate: {
                name: "TikMate",
                url: "https://api.tikmate.app/api/lookup",
                method: "POST",
                getVideoUrl: (data) => `https://tikmate.app/download/${data.token}/${data.id}.mp4`
            },
            snaptik: {
                name: "SnapTik",
                url: "https://snaptik.app/action.php",
                method: "POST",
                getVideoUrl: (data) => data.download_url || data.url
            }
        };

        const PROXY_CONFIG = {
            allorigins: "https://api.allorigins.win/get?url=",
            corsproxy: "https://corsproxy.io/?",
            thingproxy: "https://thingproxy.freeboard.io/fetch/"
        };

        // Bi·∫øn to√†n c·ª•c
        let totalProcessed = 0;
        const MAX_CONCURRENT = 3; // S·ªë video x·ª≠ l√Ω ƒë·ªìng th·ªùi t·ªëi ƒëa

        // H√†m l·∫•y c·∫•u h√¨nh hi·ªán t·∫°i
        function getCurrentConfig() {
            const apiKey = document.getElementById('apiProvider').value;
            const proxyKey = document.getElementById('proxyProvider').value;
            return {
                api: API_CONFIG[apiKey],
                proxy: PROXY_CONFIG[proxyKey]
            };
        }

        // H√†m x·ª≠ l√Ω m·ªôt URL TikTok
        async function processTikTokUrl(tiktokUrl, index = 1, total = 1) {
            const config = getCurrentConfig();
            const api = config.api;
            const proxy = config.proxy;
            
            // Chu·∫©n b·ªã d·ªØ li·ªáu cho API
            const formData = new URLSearchParams();
            formData.append('url', tiktokUrl);
            
            // X√¢y d·ª±ng URL proxy
            let proxyUrl;
            if (api.method === 'GET') {
                proxyUrl = `${proxy}${encodeURIComponent(api.url + '?' + formData.toString())}`;
            } else {
                proxyUrl = proxy + encodeURIComponent(api.url);
            }
            
            try {
                // G·ªçi API th√¥ng qua proxy
                const response = await fetch(proxyUrl, {
                    method: api.method,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: api.method === 'POST' ? formData : null
                });
                
                if (!response.ok) {
                    throw new Error(`L·ªói HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Tr√≠ch xu·∫•t video URL t·ª´ d·ªØ li·ªáu API
                let videoUrl;
                if (proxy.includes('allorigins')) {
                    // AllOrigins tr·∫£ v·ªÅ d·ªØ li·ªáu trong tr∆∞·ªùng 'contents'
                    const apiData = JSON.parse(data.contents);
                    videoUrl = api.getVideoUrl(apiData);
                } else {
                    videoUrl = api.getVideoUrl(data);
                }
                
                // X·ª≠ l√Ω URL video (n·∫øu l√† ƒë∆∞·ªùng d·∫´n t∆∞∆°ng ƒë·ªëi)
                if (videoUrl && !videoUrl.startsWith('http')) {
                    if (api.url.includes('tikwm')) {
                        videoUrl = 'https://www.tikwm.com' + videoUrl;
                    }
                }
                
                return {
                    success: true,
                    url: tiktokUrl,
                    downloadUrl: videoUrl,
                    title: `Video TikTok #${index}`,
                    apiUsed: api.name
                };
                
            } catch (error) {
                console.error(`L·ªói x·ª≠ l√Ω ${tiktokUrl}:`, error);
                return {
                    success: false,
                    url: tiktokUrl,
                    error: error.message,
                    apiUsed: api.name
                };
            }
        }

        // H√†m t·∫£i m·ªôt video
        async function downloadSingle() {
            const urlInput = document.getElementById('singleUrl').value.trim();
            if (!urlInput) {
                alert('Vui l√≤ng nh·∫≠p li√™n k·∫øt TikTok');
                return;
            }
            
            const btn = document.getElementById('singleBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            btn.disabled = true;
            loading.style.display = 'block';
            results.style.display = 'none';
            
            const result = await processTikTokUrl(urlInput, 1, 1);
            
            loading.style.display = 'none';
            btn.disabled = false;
            results.style.display = 'block';
            
            displayResult(result, 1);
            updateTotalCount();
        }

        // H√†m t·∫£i nhi·ªÅu video
        async function downloadBatch() {
            const batchTextarea = document.getElementById('batchUrls').value.trim();
            if (!batchTextarea) {
                alert('Vui l√≤ng nh·∫≠p √≠t nh·∫•t m·ªôt li√™n k·∫øt TikTok');
                return;
            }
            
            const urls = batchTextarea.split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0 && url.includes('tiktok'));
            
            if (urls.length === 0) {
                alert('Kh√¥ng t√¨m th·∫•y li√™n k·∫øt TikTok h·ª£p l·ªá');
                return;
            }
            
            if (urls.length > 10) {
                alert('Ch·ªâ h·ªó tr·ª£ t·ªëi ƒëa 10 video m·ªói l·∫ßn ƒë·ªÉ tr√°nh b·ªã ch·∫∑n');
                return;
            }
            
            const btn = document.getElementById('batchBtn');
            const loading = document.getElementById('loading');
            const progress = document.getElementById('progress');
            const results = document.getElementById('results');
            
            btn.disabled = true;
            loading.style.display = 'block';
            results.style.display = 'none';
            results.style.display = 'block';
            
            // X·ª≠ l√Ω t·ª´ng video v·ªõi gi·ªõi h·∫°n ƒë·ªìng th·ªùi
            const resultContainer = document.getElementById('resultContainer');
            resultContainer.innerHTML = '';
            
            for (let i = 0; i < urls.length; i += MAX_CONCURRENT) {
                const batch = urls.slice(i, i + MAX_CONCURRENT);
                const promises = batch.map((url, index) => 
                    processTikTokUrl(url, i + index + 1, urls.length)
                );
                
                const batchResults = await Promise.all(promises);
                
                batchResults.forEach((result, idx) => {
                    displayResult(result, i + idx + 1);
                });
                
                progress.innerHTML = `ƒê√£ x·ª≠ l√Ω: ${Math.min(i + MAX_CONCURRENT, urls.length)}/${urls.length} video`;
                await new Promise(resolve => setTimeout(resolve, 1000)); // ƒê·ª£i 1 gi√¢y gi·ªØa c√°c batch
            }
            
            loading.style.display = 'none';
            btn.disabled = false;
            updateTotalCount();
            
            alert(`ƒê√£ ho√†n th√†nh x·ª≠ l√Ω ${urls.length} video!`);
        }

        // Hi·ªÉn th·ªã k·∫øt qu·∫£
        function displayResult(result, index) {
            const container = document.getElementById('resultContainer');
            
            const card = document.createElement('div');
            card.className = 'video-card';
            card.id = `video-${index}`;
            
            let statusClass, statusText, actionButtons = '';
            
            if (result.success) {
                statusClass = 'status-success';
                statusText = '‚úì Th√†nh c√¥ng';
                actionButtons = `
                    <a href="${result.downloadUrl}" class="btn" target="_blank" download style="text-decoration: none;">
                        ‚¨áÔ∏è T·∫£i Ngay
                    </a>
                    <a href="${result.downloadUrl}" class="btn btn-secondary" target="_blank" style="text-decoration: none;">
                        üëÅÔ∏è Xem Tr∆∞·ªõc
                    </a>
                `;
            } else {
                statusClass = 'status-error';
                statusText = `‚úó L·ªói: ${result.error}`;
                actionButtons = `
                    <button class="btn btn-secondary" onclick="retryVideo(${index})">
                        üîÑ Th·ª≠ L·∫°i
                    </button>
                `;
            }
            
            card.innerHTML = `
                <div class="video-info">
                    <div class="video-title">Video #${index} (${result.apiUsed})</div>
                    <div class="video-url">${result.url.substring(0, 60)}${result.url.length > 60 ? '...' : ''}</div>
                    <div class="video-meta">
                        <span>API: ${result.apiUsed}</span>
                    </div>
                </div>
                <div class="video-actions">
                    <span class="status ${statusClass}">${statusText}</span>
                    ${actionButtons}
                </div>
            `;
            
            container.appendChild(card);
        }

        // Th·ª≠ l·∫°i video b·ªã l·ªói
        async function retryVideo(index) {
            const card = document.getElementById(`video-${index}`);
            if (!card) return;
            
            const url = card.querySelector('.video-url').textContent;
            const statusSpan = card.querySelector('.status');
            const actionsDiv = card.querySelector('.video-actions');
            
            statusSpan.className = 'status status-processing';
            statusSpan.textContent = '‚è≥ ƒêang th·ª≠ l·∫°i...';
            
            const result = await processTikTokUrl(url, index, 1);
            
            if (result.success) {
                statusSpan.className = 'status status-success';
                statusSpan.textContent = '‚úì Th√†nh c√¥ng';
                actionsDiv.innerHTML = `
                    <span class="status status-success">‚úì Th√†nh c√¥ng</span>
                    <a href="${result.downloadUrl}" class="btn" target="_blank" download style="text-decoration: none;">
                        ‚¨áÔ∏è T·∫£i Ngay
                    </a>
                    <a href="${result.downloadUrl}" class="btn btn-secondary" target="_blank" style="text-decoration: none;">
                        üëÅÔ∏è Xem Tr∆∞·ªõc
                    </a>
                `;
            } else {
                statusSpan.className = 'status status-error';
                statusSpan.textContent = `‚úó L·ªói: ${result.error}`;
                actionsDiv.innerHTML = `
                    <span class="status status-error">‚úó L·ªói: ${result.error}</span>
                    <button class="btn btn-secondary" onclick="retryVideo(${index})">
                        üîÑ Th·ª≠ L·∫°i
                    </button>
                `;
            }
            
            updateTotalCount();
        }

        // C·∫≠p nh·∫≠t t·ªïng s·ªë video ƒë√£ x·ª≠ l√Ω
        function updateTotalCount() {
            const successCards = document.querySelectorAll('.status-success').length;
            document.getElementById('totalCount').textContent = successCards;
            totalProcessed = successCards;
        }

        // X√≥a t·∫•t c·∫£
        function clearAll() {
            document.getElementById('singleUrl').value = '';
            document.getElementById('batchUrls').value = '';
            document.getElementById('resultContainer').innerHTML = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('totalCount').textContent = '0';
        }

        // T·ª± ƒë·ªông x√≥a kho·∫£ng tr·∫Øng khi d√°n li√™n k·∫øt
        document.getElementById('singleUrl').addEventListener('paste', function(e) {
            setTimeout(() => {
                this.value = this.value.trim();
            }, 100);
        });

        // Th√™m li√™n k·∫øt m·∫´u khi click v√†o placeholder
        document.getElementById('singleUrl').addEventListener('click', function() {
            if (!this.value) {
                this.value = 'https://www.tiktok.com/@tiktok/video/7100000000000000000';
            }
        });

        // Hi·ªÉn th·ªã trang k·∫øt qu·∫£ ngay khi b·∫Øt ƒë·∫ßu
        document.getElementById('results').style.display = 'block';
    </script>
</body>
</html>
