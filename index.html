<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Downloader - T·∫£i Video Kh√¥ng Watermark</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        @media (min-width: 768px) {
            .container {
                padding: 40px;
            }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        @media (min-width: 768px) {
            h1 {
                font-size: 2.5em;
            }
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        @media (min-width: 768px) {
            .subtitle {
                font-size: 1.1em;
                margin-bottom: 30px;
            }
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            background: #e0e0e0;
            color: #666;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .tab-btn {
                font-size: 16px;
                padding: 15px 30px;
            }
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .input-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .input-section {
                padding: 25px;
                margin-bottom: 30px;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        @media (min-width: 768px) {
            .input-group {
                flex-direction: row;
            }
        }

        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        @media (min-width: 768px) {
            input[type="text"] {
                padding: 15px;
                font-size: 16px;
            }
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        @media (min-width: 768px) {
            button {
                padding: 15px 30px;
                font-size: 16px;
            }
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .url-list {
            margin-top: 15px;
        }

        .url-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }

        .url-text {
            flex: 1;
            color: #333;
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .url-text {
                font-size: 14px;
            }
        }

        .remove-btn {
            padding: 5px 15px;
            background: #ff4757;
            font-size: 12px;
        }

        @media (min-width: 768px) {
            .remove-btn {
                font-size: 14px;
            }
        }

        .search-results {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        @media (min-width: 768px) {
            .search-results {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
        }

        .search-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .search-item:hover {
            transform: translateY(-5px);
        }

        .search-item img {
            width: 100%;
            aspect-ratio: 9/16;
            object-fit: cover;
        }

        .search-item-info {
            padding: 10px;
        }

        .search-item-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        @media (min-width: 768px) {
            .search-item-title {
                font-size: 14px;
            }
        }

        .search-item-meta {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
        }

        @media (min-width: 768px) {
            .search-item-meta {
                font-size: 12px;
            }
        }

        .search-item-btn {
            width: 100%;
            padding: 8px;
            margin-top: 8px;
            font-size: 12px;
        }

        @media (min-width: 768px) {
            .search-item-btn {
                padding: 10px;
                font-size: 13px;
            }
        }

        .search-item-btn.added {
            background: #4caf50;
        }

        .video-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        @media (min-width: 768px) {
            .video-card {
                padding: 20px;
            }
        }

        .video-info h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1em;
        }

        @media (min-width: 768px) {
            .video-info h3 {
                font-size: 1.2em;
            }
        }

        .video-meta {
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
        }

        @media (min-width: 768px) {
            .video-meta {
                font-size: 14px;
            }
        }

        .video-preview {
            width: 100%;
            max-width: 100%;
            border-radius: 10px;
            margin: 15px 0;
            background: #000;
        }

        @media (min-width: 768px) {
            .video-preview {
                max-width: 500px;
            }
        }

        .download-btn {
            width: 100%;
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            margin-top: 10px;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status {
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 13px;
            margin-top: 10px;
            display: inline-block;
        }

        @media (min-width: 768px) {
            .status {
                font-size: 14px;
            }
        }

        .status.loading {
            background: #fff3cd;
            color: #856404;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-item {
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ TikTok Downloader</h1>
        <p class="subtitle">T·∫£i video TikTok kh√¥ng c√≥ watermark - H·ªó tr·ª£ t√¨m ki·∫øm v√† t·∫£i nhi·ªÅu video</p>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('search')">üîç T√¨m ki·∫øm</button>
            <button class="tab-btn" onclick="switchTab('link')">üìé Th√™m link</button>
        </div>

        <!-- Tab t√¨m ki·∫øm -->
        <div id="searchTab" class="tab-content active">
            <div class="input-section">
                <div class="input-group">
                    <input type="text" id="searchInput" placeholder="Nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm... (vd: funny cat, dance)">
                    <button onclick="searchVideos()">üîç T√¨m ki·∫øm</button>
                </div>
                <div id="searchLoading" style="display: none; text-align: center;">
                    <div class="loading-spinner"></div>
                    <p style="color: #666;">ƒêang t√¨m ki·∫øm...</p>
                </div>
                <div id="searchResults" class="search-results"></div>
            </div>
        </div>

        <!-- Tab th√™m link -->
        <div id="linkTab" class="tab-content">
            <div class="input-section">
                <div class="input-group">
                    <input type="text" id="urlInput" placeholder="D√°n link TikTok v√†o ƒë√¢y...">
                    <button onclick="addUrl()">‚ûï Th√™m</button>
                </div>
                <div id="urlList" class="url-list"></div>
            </div>
        </div>

        <!-- Danh s√°ch t·∫£i -->
        <div class="input-section" style="background: #e8f5e9;">
            <h3 style="margin-bottom: 15px; font-size: 1em;">üìã Danh s√°ch t·∫£i xu·ªëng (<span id="urlCount">0</span> video)</h3>
            <div id="downloadList" class="url-list"></div>
            <button id="downloadAllBtn" onclick="downloadAll()" style="width: 100%; margin-top: 15px;" disabled>
                üöÄ T·∫£i t·∫•t c·∫£ video
            </button>
        </div>

        <div id="progressContainer" class="progress-container" style="display: none;"></div>
        
        <div id="autoDownloadSection" style="display: none; text-align: center; margin: 20px 0;">
            <button onclick="autoDownloadAll()" style="width: 100%; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); font-size: 16px; padding: 15px;">
                ‚¨áÔ∏è T·ª± ƒë·ªông t·∫£i xu·ªëng t·∫•t c·∫£ (HD)
            </button>
            <p style="color: #666; margin-top: 10px; font-size: 12px;">Video s·∫Ω ƒë∆∞·ª£c t·∫£i v·ªÅ th∆∞ m·ª•c Downloads</p>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let urlList = [];
        let downloadedVideos = [];

        function switchTab(tab) {
            // ·∫®n t·∫•t c·∫£ tabs
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            // Hi·ªÉn th·ªã tab ƒë∆∞·ª£c ch·ªçn
            if (tab === 'search') {
                document.getElementById('searchTab').classList.add('active');
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
            } else {
                document.getElementById('linkTab').classList.add('active');
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
            }
        }

        async function searchVideos() {
            const keyword = document.getElementById('searchInput').value.trim();
            const searchResults = document.getElementById('searchResults');
            const searchLoading = document.getElementById('searchLoading');

            if (!keyword) {
                alert('Vui l√≤ng nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm!');
                return;
            }

            searchLoading.style.display = 'block';
            searchResults.innerHTML = '';

            try {
                const apiUrl = `https://www.tikwm.com/api/feed/search?keywords=${encodeURIComponent(keyword)}&count=20&cursor=0&hd=1`;
                const response = await fetch(apiUrl);
                const data = await response.json();

                searchLoading.style.display = 'none';

                if (data.code !== 0 || !data.data || !data.data.videos || data.data.videos.length === 0) {
                    searchResults.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Kh√¥ng t√¨m th·∫•y video n√†o üò¢</p>';
                    return;
                }

                displaySearchResults(data.data.videos);

            } catch (error) {
                console.error('Search error:', error);
                searchLoading.style.display = 'none';
                searchResults.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #f44336;">
                        ‚ùå L·ªói: ${error.message}<br>
                        <small>Vui l√≤ng th·ª≠ l·∫°i</small>
                    </div>
                `;
            }
        }

        function displaySearchResults(videos) {
            const searchResults = document.getElementById('searchResults');
            
            searchResults.innerHTML = videos.map((video, index) => {
                const videoUrl = `https://www.tiktok.com/@${video.author?.unique_id || 'user'}/video/${video.video_id}`;
                const isAdded = urlList.includes(videoUrl);
                
                return `
                    <div class="search-item">
                        <img src="${video.cover || video.origin_cover}" alt="Video" loading="lazy">
                        <div class="search-item-info">
                            <div class="search-item-title">${video.title || 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ'}</div>
                            <div class="search-item-meta">üë§ @${video.author?.unique_id || 'N/A'}</div>
                            <div class="search-item-meta">‚ù§Ô∏è ${formatNumber(video.digg_count || 0)} | üí¨ ${formatNumber(video.comment_count || 0)}</div>
                            <button class="search-item-btn ${isAdded ? 'added' : ''}" 
                                    onclick="addSearchResult('${videoUrl.replace(/'/g, "\\'")}', ${index})"
                                    ${isAdded ? 'disabled' : ''}>
                                ${isAdded ? '‚úì ƒê√£ th√™m' : '+ Th√™m'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addSearchResult(url, index) {
            if (urlList.includes(url)) return;
            
            urlList.push(url);
            updateDownloadList();
            
            // C·∫≠p nh·∫≠t n√∫t
            const items = document.querySelectorAll('.search-item');
            if (items[index]) {
                const btn = items[index].querySelector('.search-item-btn');
                btn.textContent = '‚úì ƒê√£ th√™m';
                btn.classList.add('added');
                btn.disabled = true;
            }
        }

        function addUrl() {
            const input = document.getElementById('urlInput');
            const url = input.value.trim();

            if (!url) {
                alert('Vui l√≤ng nh·∫≠p link TikTok!');
                return;
            }

            if (!url.includes('tiktok.com')) {
                alert('Link kh√¥ng h·ª£p l·ªá!');
                return;
            }

            if (urlList.includes(url)) {
                alert('Link n√†y ƒë√£ ƒë∆∞·ª£c th√™m!');
                return;
            }

            urlList.push(url);
            input.value = '';
            updateDownloadList();
        }

        function removeUrl(index) {
            urlList.splice(index, 1);
            updateDownloadList();
        }

        function updateDownloadList() {
            const container = document.getElementById('downloadList');
            const countSpan = document.getElementById('urlCount');
            const downloadBtn = document.getElementById('downloadAllBtn');

            countSpan.textContent = urlList.length;
            downloadBtn.disabled = urlList.length === 0;

            if (urlList.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 10px;">Ch∆∞a c√≥ video n√†o</p>';
                return;
            }

            container.innerHTML = urlList.map((url, index) => `
                <div class="url-item">
                    <span class="url-text">${url}</span>
                    <button class="remove-btn" onclick="removeUrl(${index})">X√≥a</button>
                </div>
            `).join('');
        }

        async function downloadAll() {
            if (urlList.length === 0) return;

            const resultsDiv = document.getElementById('results');
            const progressContainer = document.getElementById('progressContainer');
            const autoDownloadSection = document.getElementById('autoDownloadSection');
            const downloadBtn = document.getElementById('downloadAllBtn');

            resultsDiv.innerHTML = '';
            progressContainer.style.display = 'block';
            progressContainer.innerHTML = '';
            autoDownloadSection.style.display = 'none';
            downloadBtn.disabled = true;
            downloadedVideos = [];

            for (let i = 0; i < urlList.length; i++) {
                const url = urlList[i];
                const progressId = `progress-${i}`;
                
                progressContainer.innerHTML += `
                    <div class="progress-item" id="${progressId}">
                        <div>Video ${i + 1}/${urlList.length}</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="statu